// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –ü—Ä–∏–∫–ª–∞–¥—É 1 - –ë–∞–∑–æ–≤–∞ HTTP –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è!
// –¶–µ –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∞ —Ñ–æ—Ä–º–∞ –≤–µ–±-–∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó. –ö–ª—ñ—î–Ω—Ç –ø–æ–≤–∏–Ω–µ–Ω –≤—Ä—É—á–Ω—É
// –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –•–æ—á–∞ —Ü–µ –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥,
// –≤—ñ–Ω –¥–æ–ø–æ–º–∞–≥–∞—î –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –æ—Å–Ω–æ–≤–∏ —Ü–∏–∫–ª—ñ–≤ –∑–∞–ø–∏—Ç-–≤—ñ–¥–ø–æ–≤—ñ–¥—å HTTP.

const express = require('express');
const path = require('path');

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –°—Ç–≤–æ—Ä—é—î–º–æ –µ–∫–∑–µ–º–ø–ª—è—Ä Express –¥–æ–¥–∞—Ç–∫—É
const app = express();
const PORT = 3000;

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤ –ø–∞–º'—è—Ç—ñ
// –í —Ä–µ–∞–ª—å–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É –≤–∏ –± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö
const messages = [];

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: Middleware –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É JSON —Ç—ñ–ª–∞ –∑–∞–ø–∏—Ç—ñ–≤
app.use(express.json());

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ (HTML, CSS, JS) –∑ –ø–æ—Ç–æ—á–Ω–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
app.use(express.static(__dirname));

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: GET –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—Å—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
// –¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –º–æ–¥–µ–ª—å "pull" - –∫–ª—ñ—î–Ω—Ç –∑–∞–ø–∏—Ç—É—î –¥–∞–Ω—ñ
app.get('/messages', (req, res) => {
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –≤—Å—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —è–∫ JSON
    console.log(`üì• GET /messages - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ ${messages.length} –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å`);
    res.json(messages);
});

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: POST –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
// –¢–∞–∫ –∫–ª—ñ—î–Ω—Ç–∏ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å –¥–∞–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
app.post('/messages', (req, res) => {
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –í–∏—Ç—è–≥—É—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ —Ç–µ–∫—Å—Ç –∑ —Ç—ñ–ª–∞ –∑–∞–ø–∏—Ç—É
    const { user, text } = req.body;
    
    // ‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è: –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ –≤–∏ –± –≤–∞–ª—ñ–¥—É–≤–∞–ª–∏ —Ç–∞ –æ—á–∏—â–∞–ª–∏ —Ü–µ–π –≤–≤—ñ–¥!
    if (!text || text.trim() === '') {
        return res.status(400).json({ error: '–¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –æ–±–æ–≤\'—è–∑–∫–æ–≤–∏–π' });
    }
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –°—Ç–≤–æ—Ä—é—î–º–æ –æ–±'—î–∫—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –º—ñ—Ç–∫–æ—é —á–∞—Å—É
    const message = {
        id: messages.length + 1,
        user: user || '–ê–Ω–æ–Ω—ñ–º',
        text: text.trim(),
        timestamp: new Date().toISOString()
    };
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –ø–∞–º'—è—Ç—ñ
    messages.push(message);
    console.log(`üí¨ –ù–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ ${message.user}: ${message.text}`);
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ —É—Å–ø—ñ—à–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å
    res.status(201).json({ success: true, message });
});

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ó–∞–ø—É—Å–∫–∞—î–º–æ —Å–µ—Ä–≤–µ—Ä
app.listen(PORT, () => {
    console.log(`üöÄ –ë–∞–∑–æ–≤–∏–π HTTP —Å–µ—Ä–≤–µ—Ä –ø—Ä–∞—Ü—é—î –Ω–∞ http://localhost:${PORT}`);
    console.log('üìù –ü—Ä–∏–∫–ª–∞–¥ 1: –ü–æ—Ç—Ä—ñ–±–Ω–µ —Ä—É—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –Ω–æ–≤–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å');
    console.log('‚ö° –¶—ñ–∫–∞–≤–∏–π —Ñ–∞–∫—Ç: –¢–∞–∫ –ø—Ä–∞—Ü—é–≤–∞–≤ –≤–µ–± —É 1990-—Ö —Ä–æ–∫–∞—Ö!');
});

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ö–ª—é—á–æ–≤—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è –±–∞–∑–æ–≤–æ–≥–æ HTTP:
// 1. –ù–µ–º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –ø–æ–≤–∏–Ω–Ω—ñ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –≤—Ä—É—á–Ω—É
// 2. –ù–µ–ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–∏—Ö - –º–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –í–°–Ü –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —â–æ—Ä–∞–∑—É
// 3. –ü–æ–≥–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –¥–æ—Å–≤—ñ–¥ - –ª–µ–≥–∫–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
// 4. –°–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–∂–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞–º
