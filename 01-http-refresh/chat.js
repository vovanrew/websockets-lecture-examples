// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ü—Ä–∏–∫–ª–∞–¥ 1 - –ë–∞–∑–æ–≤–∏–π HTTP —á–∞—Ç-–∫–ª—ñ—î–Ω—Ç
// –¶–µ–π JavaScript —Ñ–∞–π–ª –æ–±—Ä–æ–±–ª—è—î –∫–ª—ñ—î–Ω—Ç—Å—å–∫—É –ª–æ–≥—ñ–∫—É –¥–ª—è –Ω–∞—à–æ–≥–æ –±–∞–∑–æ–≤–æ–≥–æ HTTP —á–∞—Ç—É.
// –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —è–∫–∏–π –≤—ñ–Ω –ø—Ä–æ—Å—Ç–∏–π - –º–∏ –ª–∏—à–µ –æ—Ç—Ä–∏–º—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–æ–≤—ñ.

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –û—Ç—Ä–∏–º—É—î–º–æ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∑–∞–ø–∏—Ç—É
const urlParams = new URLSearchParams(window.location.search);
const username = urlParams.get('user') || '–ê–Ω–æ–Ω—ñ–º';

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
document.getElementById('currentUser').textContent = username;

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –º—ñ—Ç–æ–∫ —á–∞—Å—É –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
function formatTime(timestamp) {
    const date = new Date(timestamp);
    return date.toLocaleTimeString('uk-UA', { 
        hour: '2-digit', 
        minute: '2-digit' 
    });
}

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤ UI
function displayMessages(messages) {
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –û—Ç—Ä–∏–º—É—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
    const messagesDiv = document.getElementById('messages');
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –û—á–∏—â–∞—î–º–æ —ñ—Å–Ω—É—é—á—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    messagesDiv.innerHTML = '';
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –∫–æ–∂–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    messages.forEach(message => {
        const messageElement = document.createElement('div');
        messageElement.className = 'message';
        
        // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –°—Ç–≤–æ—Ä—é—î–º–æ HTML –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —ñ–º'—è–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –º—ñ—Ç–∫–æ—é —á–∞—Å—É
        messageElement.innerHTML = `
            <span class="username">${message.user}:</span>
            <span class="text">${message.text}</span>
            <span class="timestamp">${formatTime(message.timestamp)}</span>
        `;
        
        messagesDiv.appendChild(messageElement);
    });
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ü—Ä–æ–∫—Ä—É—á—É—î–º–æ –≤–Ω–∏–∑, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑ —Å–µ—Ä–≤–µ—Ä–∞
async function loadMessages() {
    try {
        // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –†–æ–±–∏–º–æ GET –∑–∞–ø–∏—Ç –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
        console.log('üîÑ –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–∞...');
        const response = await fetch('/messages'); // 127.0.0.1:3000/messages
        
        // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∑–∞–ø–∏—Ç –±—É–≤ —É—Å–ø—ñ—à–Ω–∏–º
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ü–∞—Ä—Å–∏–º–æ JSON –≤—ñ–¥–ø–æ–≤—ñ–¥—å
        const messages = await response.json();
        console.log(`‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${messages.length} –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å`);
        
        // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        displayMessages(messages);
        
    } catch (error) {
        // ‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è: –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ –≤–∏ –± –æ–±—Ä–æ–±–ª—è–ª–∏ –ø–æ–º–∏–ª–∫–∏ –±—ñ–ª—å—à –µ–ª–µ–≥–∞–Ω—Ç–Ω–æ
        console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:', error);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –ë—É–¥—å –ª–∞—Å–∫–∞, –æ–Ω–æ–≤—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É.');
    }
}

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
async function sendMessage() {
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –û—Ç—Ä–∏–º—É—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –≤–≤–æ–¥—É —Ç–∞ —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    const input = document.getElementById('messageInput');
    const text = input.value.trim();
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ù–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    if (!text) {
        return;
    }
    
    try {
        // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –í–∏–º–∏–∫–∞—î–º–æ –≤–≤—ñ–¥ –ø—ñ–¥ —á–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
        input.disabled = true;
        document.getElementById('sendButton').disabled = true;
        
        // üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –†–æ–±–∏–º–æ POST –∑–∞–ø–∏—Ç –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        console.log('üì§ –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...');
        const response = await fetch('/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                user: username,
                text: text
            })
        });
        
        // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∑–∞–ø–∏—Ç –±—É–≤ —É—Å–ø—ñ—à–Ω–∏–º
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        console.log('‚úÖ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ');
        
        // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ –≤–≤–æ–¥—É
        input.value = '';
        
        // üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞—à–µ –Ω–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        // –£–≤–∞–≥–∞: –¶–µ –ø–æ–∫–∞–∑—É—î –õ–ò–®–ï –ù–ê–®–ï –Ω–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –∞ –Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ —ñ–Ω—à–∏—Ö!
        await loadMessages();
        
    } catch (error) {
        // ‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è: –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ –≤–∏ –± –æ–±—Ä–æ–±–ª—è–ª–∏ –ø–æ–º–∏–ª–∫–∏ –±—ñ–ª—å—à –µ–ª–µ–≥–∞–Ω—Ç–Ω–æ
        console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', error);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
        
    } finally {
        // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ó–Ω–æ–≤—É –≤–º–∏–∫–∞—î–º–æ –≤–≤—ñ–¥
        input.disabled = false;
        document.getElementById('sendButton').disabled = false;
        input.focus();
    }
}

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
document.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ –ß–∞—Ç-–∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
    console.log(`üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${username}`);
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    loadMessages();
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏
    document.getElementById('sendButton').addEventListener('click', sendMessage);
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–ª–∞–≤—ñ—à—ñ Enter
    document.getElementById('messageInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –§–æ–∫—É—Å—É—î–º–æ—Å—è –Ω–∞ –ø–æ–ª—ñ –≤–≤–æ–¥—É
    document.getElementById('messageInput').focus();
});

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ö–ª—é—á–æ–≤—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è —Ü—å–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É:
// 1. –ù–µ–º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å - –º–∏ –±–∞—á–∏–º–æ –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ª–∏—à–µ –ø—ñ—Å–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
// 2. –ü–æ–≥–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –¥–æ—Å–≤—ñ–¥ - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–µ –∑–Ω–∞—é—Ç—å, –∫–æ–ª–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç—å –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
// 3. –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –º—ñ–∂ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º–∏
// 4. –ù–µ–º–∞—î –≤–∑–∞—î–º–æ–¥—ñ—ó –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ - –±—ñ–ª—å—à–µ —Å—Ö–æ–∂–µ –Ω–∞ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –ø–æ—à—Ç—É, –Ω—ñ–∂ –Ω–∞ —á–∞—Ç

// ‚ö° –¶—ñ–∫–∞–≤–∏–π —Ñ–∞–∫—Ç: –î–æ AJAX (2005), –£–°–Ü –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø—Ä–∞—Ü—é–≤–∞–ª–∏ —Å–∞–º–µ —Ç–∞–∫!
// –ö–æ–∂–Ω–∞ –≤–∑–∞—î–º–æ–¥—ñ—è –≤–∏–º–∞–≥–∞–ª–∞ –ø–æ–≤–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏.
