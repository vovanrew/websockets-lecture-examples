// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –ü—Ä–∏–∫–ª–∞–¥—É 2 - HTTP –ö–æ—Ä–æ—Ç–∫–µ –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è!
// –¶–µ–π –ø—Ä–∏–∫–ª–∞–¥ –ø–æ–∫—Ä–∞—â—É—î –±–∞–∑–æ–≤–∏–π HTTP, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –Ω–æ–≤–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.
// –ö–ª—ñ—î–Ω—Ç –æ–ø–∏—Ç—É—î (–∑–∞–ø–∏—Ç—É—î) —Å–µ—Ä–≤–µ—Ä –∫–æ–∂–Ω—ñ 20 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è.
// –•–æ—á–∞ —Ü–µ –∫—Ä–∞—â–µ –∑–∞ —Ä—É—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, —Ü–µ–π –ø—ñ–¥—Ö—ñ–¥ –≤—Å–µ —â–µ –º–∞—î –æ–±–º–µ–∂–µ–Ω–Ω—è.

const express = require('express');
const path = require('path');

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –°—Ç–≤–æ—Ä—é—î–º–æ Express –¥–æ–¥–∞—Ç–æ–∫
const app = express();
const PORT = 3000;

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤ –ø–∞–º'—è—Ç—ñ
const messages = [];

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –í—ñ–¥—Å—Ç–µ–∂—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Ü—ñ–ª–µ–π
let pollCount = 0;
let messagesSentCount = 0;

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è middleware
app.use(express.json());
app.use(express.static(__dirname));

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –¢–æ–π —Å–∞–º–∏–π GET –µ–Ω–¥–ø–æ—ñ–Ω—Ç, —â–æ —ñ –≤ –ü—Ä–∏–∫–ª–∞–¥—ñ 1, –∞–ª–µ —Ç–µ–ø–µ—Ä –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø–æ—Å—Ç—ñ–π–Ω–æ
app.get('/messages', (req, res) => {
    pollCount++;
    
    // üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –õ–æ–≥—É—î–º–æ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó —á–∞—Å—Ç–æ—Ç–∏
    console.log(`üìä –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è #${pollCount} - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ ${messages.length} –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å`);
    
    // üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É - –º–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –£–°–Ü –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —â–æ—Ä–∞–∑—É
    // –¶–µ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –∞–ª–µ –ø—Ä–æ—Å—Ç–æ –≤ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó
    res.json(messages);
    
    // ‚ö° –¶—ñ–∫–∞–≤–∏–π —Ñ–∞–∫—Ç: –ó—ñ 100 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏, —â–æ –æ–ø–∏—Ç—É—é—Ç—å –∫–æ–∂–Ω—ñ 20 —Å–µ–∫—É–Ω–¥,
    // —Ü–µ–π –µ–Ω–¥–ø–æ—ñ–Ω—Ç –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏–º–µ 300 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É!
});

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: POST –µ–Ω–¥–ø–æ—ñ–Ω—Ç –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Ç–∞–∫–∏–º —Å–∞–º–∏–º, —è–∫ —É –ü—Ä–∏–∫–ª–∞–¥—ñ 1
app.post('/messages', (req, res) => {
    const { user, text } = req.body;
    
    // ‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è: –£ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ –≤—Å–µ —â–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–≤–æ–¥—É!
    if (!text || text.trim() === '') {
        return res.status(400).json({ error: '–¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –æ–±–æ–≤\'—è–∑–∫–æ–≤–∏–π' });
    }
    
    const message = {
        id: messages.length + 1,
        user: user || '–ê–Ω–æ–Ω—ñ–º',
        text: text.trim(),
        timestamp: new Date().toISOString()
    };
    
    messages.push(message);
    messagesSentCount++;
    
    console.log(`üí¨ –ù–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è #${messagesSentCount} –≤—ñ–¥ ${message.user}: ${message.text}`);
    
    res.status(201).json({ success: true, message });
});

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ï–Ω–¥–ø–æ—ñ–Ω—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Ü—ñ–ª–µ–π)
app.get('/stats', (req, res) => {
    res.json({
        totalPolls: pollCount,
        totalMessages: messages.length,
        pollsPerMessage: messages.length > 0 ? (pollCount / messages.length).toFixed(1) : 0
    });
});

// üîß –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ó–∞–ø—É—Å–∫–∞—î–º–æ —Å–µ—Ä–≤–µ—Ä –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏–º –ª–æ–≥—É–≤–∞–Ω–Ω—è–º
app.listen(PORT, () => {
    console.log(`üöÄ HTTP —Å–µ—Ä–≤–µ—Ä –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∞—Ü—é—î –Ω–∞ http://localhost:${PORT}`);
    console.log('üìù –ü—Ä–∏–∫–ª–∞–¥ 2: –ö–ª—ñ—î–Ω—Ç –æ–ø–∏—Ç—É—î –∫–æ–∂–Ω—ñ 20 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è');
    console.log('üëÄ –°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ –∫–æ–Ω—Å–æ–ª–ª—é, —â–æ–± –±–∞—á–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è!');
    
    // üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
    console.log('\n‚ö†Ô∏è  –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è:');
    console.log('   - –ú–∞—Ä–Ω—É—î –ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å (–≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –≤—Å—ñ –¥–∞–Ω—ñ –ø–æ–≤—Ç–æ—Ä–Ω–æ)');
    console.log('   - –ú–∞—Ä–Ω—É—î —Ä–µ—Å—É—Ä—Å–∏ —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ—Å—Ç—ñ–π–Ω—ñ –∑–∞–ø–∏—Ç–∏)');
    console.log('   - –ó–∞—Ç—Ä–∏–º–∫–∏ –¥–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è (20 —Å–µ–∫—É–Ω–¥)');
    console.log('   - –ê–ª–µ: –ü—Ä–æ—Å—Ç–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç–∞ –∑—Ä–æ–∑—É–º—ñ—Ç–∏!\n');
});

// üéì –ù–∞–≤—á–∞–ª—å–Ω–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: –ö–æ–º–ø—Ä–æ–º—ñ—Å–∏ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è:
// –ü–ª—é—Å–∏:
// - –ü—Ä–æ—Å—Ç–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ (–ø—Ä–æ—Å—Ç–æ setInterval –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ)
// - –ü—Ä–∞—Ü—é—î –∑—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º HTTP (–Ω–µ–º–∞—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö –≤–∏–º–æ–≥)
// - –î—Ä—É–∂–Ω—ñ–π –¥–æ —Ñ–∞–π—Ä–≤–æ–ª—ñ–≤ (–∑–≤–∏—á–∞–π–Ω—ñ HTTP –∑–∞–ø–∏—Ç–∏)
//
// –ú—ñ–Ω—É—Å–∏:
// - –ù–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ (–±—ñ–ª—å—à—ñ—Å—Ç—å –æ–ø–∏—Ç—É–≤–∞–Ω—å –Ω–µ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å –Ω–æ–≤—ñ –¥–∞–Ω—ñ)
// - –ù–µ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π real-time (20-—Å–µ–∫—É–Ω–¥–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞)
// - –í–µ–ª–∏–∫–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∑ –±–∞–≥–∞—Ç—å–º–∞ –∫–ª—ñ—î–Ω—Ç–∞–º–∏
// - –ú–∞—Ä–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–æ–ø—É—Å–∫–Ω–æ—ó –∑–¥–∞—Ç–Ω–æ—Å—Ç—ñ (–ø–æ–≤—Ç–æ—Ä–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤—Å—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å)
